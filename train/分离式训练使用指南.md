# ğŸš€ åˆ†ç¦»å¼è®­ç»ƒæ–¹æ¡ˆä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

å°†å›¾åƒé™è´¨å¤„ç†å’Œæ¨¡å‹è®­ç»ƒåˆ†ç¦»æˆä¸¤ä¸ªç‹¬ç«‹è„šæœ¬ï¼Œæé«˜è®­ç»ƒæ•ˆç‡å’Œçµæ´»æ€§ï¼š

1. **`generate_lr_images.py`** - é¢„ç”Ÿæˆä½åˆ†è¾¨ç‡å›¾åƒ
2. **`train_from_pregenerated.py`** - ä½¿ç”¨é¢„ç”Ÿæˆæ•°æ®è®­ç»ƒæ¨¡å‹

## ğŸ¯ ä¼˜åŠ¿

### ç›¸æ¯”åŸå§‹æ–¹æ¡ˆçš„æ”¹è¿›ï¼š
- âœ… **é¢„å¤„ç†åˆ†ç¦»**ï¼šå›¾åƒå¤„ç†åªéœ€åšä¸€æ¬¡ï¼Œä¸é‡å¤è®¡ç®—
- âœ… **è®­ç»ƒåŠ é€Ÿ**ï¼šè®­ç»ƒæ—¶ç›´æ¥åŠ è½½å¤„ç†å¥½çš„å›¾åƒï¼Œæ— éœ€å®æ—¶å¤„ç†
- âœ… **å­˜å‚¨å‹å¥½**ï¼šå¯ä»¥æ£€æŸ¥å’ŒéªŒè¯é¢„å¤„ç†ç»“æœ
- âœ… **å®éªŒçµæ´»**ï¼šå¯ä»¥ç”¨åŒä¸€æ‰¹é¢„å¤„ç†æ•°æ®è®­ç»ƒä¸åŒæ¨¡å‹
- âœ… **è°ƒè¯•ä¾¿åˆ©**ï¼šå¯ä»¥å•ç‹¬è°ƒè¯•æ•°æ®å¤„ç†å’Œè®­ç»ƒéƒ¨åˆ†

### ç›¸æ¯”åœ¨çº¿å¤„ç†çš„æ€§èƒ½æå‡ï¼š
- ğŸ”¥ **I/Oä¼˜åŒ–**ï¼šå‡å°‘è®­ç»ƒæ—¶çš„å›¾åƒè¯»å–å’Œå¤„ç†å¼€é”€
- ğŸ”¥ **å†…å­˜ç¨³å®š**ï¼šé¿å…è®­ç»ƒæ—¶çš„å†…å­˜æ³¢åŠ¨
- ğŸ”¥ **ç¼“å­˜å‹å¥½**ï¼šé¢„å¤„ç†åçš„æ•°æ®æ›´é€‚åˆGPUç¼“å­˜

## ğŸ“‚ ç›®å½•ç»“æ„

```
Super_resolution/
â”œâ”€â”€ OST/                           # åŸå§‹é«˜åˆ†è¾¨ç‡æ•°æ®
â”‚   â”œâ”€â”€ mountain/
â”‚   â”œâ”€â”€ building/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ OST_LR/                        # ç”Ÿæˆçš„ä½åˆ†è¾¨ç‡æ•°æ®
â”‚   â”œâ”€â”€ scale_4x/
â”‚   â”‚   â”œâ”€â”€ mountain/
â”‚   â”‚   â”‚   â”œâ”€â”€ img1_lr_4x.png           # åŸå§‹ä½åˆ†è¾¨ç‡ç‰ˆæœ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ img1_upsampled_4x.png    # ä¸Šé‡‡æ ·åˆ°è®­ç»ƒå°ºå¯¸
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ processing_stats.json      # å¤„ç†ç»Ÿè®¡ä¿¡æ¯
â”œâ”€â”€ generate_lr_images.py          # æ•°æ®é¢„å¤„ç†è„šæœ¬
â”œâ”€â”€ train_from_pregenerated.py     # è®­ç»ƒè„šæœ¬
â””â”€â”€ realESRGAN_from_pregenerated.pth  # è®­ç»ƒå¥½çš„æ¨¡å‹
```

## ğŸ›  ä½¿ç”¨æ­¥éª¤

### æ­¥éª¤1ï¼šç”Ÿæˆä½åˆ†è¾¨ç‡å›¾åƒ

```bash
# åŸºæœ¬ç”¨æ³• - ç”Ÿæˆ4xé™è´¨çš„å›¾åƒ
python generate_lr_images.py

# è‡ªå®šä¹‰å‚æ•°
python generate_lr_images.py \
    --input ./OST \
    --output ./OST_LR \
    --scales 2 3 4 \
    --size 512 \
    --method cubic

# è‡ªåŠ¨å¤„ç†ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰
python generate_lr_images.py --auto

# å¤„ç†éƒ¨åˆ†æ•°æ®ï¼ˆç”¨äºå¿«é€Ÿæµ‹è¯•ï¼‰
python generate_lr_images.py --sample 0.1 --auto
```

#### å‚æ•°è¯´æ˜ï¼š
- `--input, -i`: è¾“å…¥æ•°æ®é›†ç›®å½•ï¼ˆé»˜è®¤: ./OSTï¼‰
- `--output, -o`: è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤: ./OST_LRï¼‰
- `--scales, -s`: é™è´¨å€æ•°åˆ—è¡¨ï¼ˆé»˜è®¤: [4]ï¼‰
- `--size`: ç›®æ ‡å›¾åƒå°ºå¯¸ï¼ˆé»˜è®¤: 512ï¼‰
- `--sample`: é‡‡æ ·æ¯”ä¾‹ï¼Œ1.0=å…¨éƒ¨å¤„ç†ï¼ˆé»˜è®¤: 1.0ï¼‰
- `--method`: æ’å€¼æ–¹æ³• nearest/linear/cubicï¼ˆé»˜è®¤: cubicï¼‰
- `--auto`: è‡ªåŠ¨å¤„ç†ï¼Œè·³è¿‡ç¡®è®¤

### æ­¥éª¤2ï¼šè®­ç»ƒæ¨¡å‹

```bash
# ä½¿ç”¨é¢„ç”Ÿæˆçš„æ•°æ®è®­ç»ƒ
python train_from_pregenerated.py
```

## âš™ï¸ é…ç½®é€‰é¡¹

### `generate_lr_images.py` é…ç½®

```python
# åœ¨è„šæœ¬é¡¶éƒ¨ä¿®æ”¹è¿™äº›å‚æ•°
DATA_ROOT = './OST'          # åŸå§‹æ•°æ®ç›®å½•
OUTPUT_ROOT = './OST_LR'     # è¾“å‡ºç›®å½•
SCALE_FACTORS = [4]          # é™è´¨å€æ•°
TARGET_SIZE = 512            # ç›®æ ‡å°ºå¯¸
SAMPLE_RATIO = 1.0           # é‡‡æ ·æ¯”ä¾‹
```

### `train_from_pregenerated.py` é…ç½®

```python
# æ¨¡å‹å¤æ‚åº¦é€‰æ‹©
CURRENT_MODEL = 'ultra_lite'  # 'ultra_lite', 'lite', 'standard'

# è®­ç»ƒå‚æ•°
BATCH_SIZE = 2               # æ‰¹æ¬¡å¤§å°
NUM_EPOCHS = 15              # è®­ç»ƒè½®æ•°
LR = 1e-3                    # å­¦ä¹ ç‡
SCALE_FACTOR = 4             # ä½¿ç”¨çš„é™è´¨å€æ•°
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ–¹æ¡ˆ | æ•°æ®å¤„ç† | è®­ç»ƒé€Ÿåº¦ | å†…å­˜ä½¿ç”¨ | çµæ´»æ€§ |
|------|----------|----------|----------|---------|
| åŸå§‹åœ¨çº¿å¤„ç† | æ¯æ¬¡é‡å¤ | æ…¢ | é«˜ | ä½ |
| é¢„ç”Ÿæˆæ–¹æ¡ˆ | ä¸€æ¬¡æ€§ | å¿« | ä½ | é«˜ |

### é¢„æœŸæ€§èƒ½æå‡ï¼š
- **æ•°æ®åŠ è½½é€Ÿåº¦**: æå‡2-3å€
- **è®­ç»ƒç¨³å®šæ€§**: å†…å­˜ä½¿ç”¨æ›´ç¨³å®š
- **è°ƒè¯•æ•ˆç‡**: å¯å•ç‹¬éªŒè¯æ•°æ®å¤„ç†ç»“æœ

## ğŸ” éªŒè¯å’Œè°ƒè¯•

### æ£€æŸ¥é¢„ç”Ÿæˆç»“æœ

```python
# æŸ¥çœ‹å¤„ç†ç»Ÿè®¡
import json
with open('./OST_LR/processing_stats.json', 'r') as f:
    stats = json.load(f)
    print(f"å¤„ç†äº† {stats['total_processed']} å¼ å›¾åƒ")
    print(f"å¤±è´¥ {stats['total_failed']} å¼ ")
    print(f"å¹³å‡å¤„ç†æ—¶é—´: {stats['avg_processing_time']:.3f}s")
```

### å¯è§†åŒ–æ£€æŸ¥

```python
# ç®€å•çš„å›¾åƒå¯¹æ¯”è„šæœ¬
import matplotlib.pyplot as plt
from PIL import Image
import numpy as np

# åŠ è½½å›¾åƒå¯¹
hr_path = "./OST/mountain/img1.jpg"
lr_path = "./OST_LR/scale_4x/mountain/img1_upsampled_4x.png"

hr_img = np.array(Image.open(hr_path).convert('L'))
lr_img = np.array(Image.open(lr_path).convert('L'))

# æ˜¾ç¤ºå¯¹æ¯”
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(10, 5))
ax1.imshow(hr_img, cmap='gray')
ax1.set_title('High Resolution')
ax2.imshow(lr_img, cmap='gray')
ax2.set_title('Low Resolution (Upsampled)')
plt.show()
```

## ğŸ¯ ä½¿ç”¨å»ºè®®

### 1. å¿«é€Ÿæµ‹è¯•å·¥ä½œæµ
```bash
# å…ˆç”¨å°æ•°æ®é‡æµ‹è¯•
python generate_lr_images.py --sample 0.05 --auto
python train_from_pregenerated.py
```

### 2. ç”Ÿäº§ç¯å¢ƒå·¥ä½œæµ
```bash
# å¤„ç†å…¨éƒ¨æ•°æ®
python generate_lr_images.py --auto
python train_from_pregenerated.py
```

### 3. å¤šå°ºåº¦å®éªŒ
```bash
# ç”Ÿæˆå¤šä¸ªscale factorçš„æ•°æ®
python generate_lr_images.py --scales 2 3 4 --auto

# åˆ†åˆ«è®­ç»ƒä¸åŒscaleçš„æ¨¡å‹ï¼ˆéœ€è¦ä¿®æ”¹trainè„šæœ¬ä¸­çš„SCALE_FACTORï¼‰
# SCALE_FACTOR = 2 è®­ç»ƒ2xæ¨¡å‹
# SCALE_FACTOR = 3 è®­ç»ƒ3xæ¨¡å‹  
# SCALE_FACTOR = 4 è®­ç»ƒ4xæ¨¡å‹
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

### å­˜å‚¨ç©ºé—´è¦æ±‚
- é¢„ç”Ÿæˆçš„æ•°æ®ä¼šå ç”¨é¢å¤–å­˜å‚¨ç©ºé—´
- æ¯ä¸ªscale factorä¼šç”Ÿæˆ2ä»½æ–‡ä»¶ï¼ˆåŸå§‹ä½åˆ†è¾¨ç‡ + ä¸Šé‡‡æ ·ç‰ˆæœ¬ï¼‰
- ä¼°ç®—å…¬å¼ï¼šå­˜å‚¨éœ€æ±‚ â‰ˆ åŸå§‹æ•°æ®å¤§å° Ã— scaleæ•°é‡ Ã— 2

### æ•°æ®ä¸€è‡´æ€§
- ç¡®ä¿é¢„ç”Ÿæˆæ•°æ®å’Œè®­ç»ƒè„šæœ¬ä½¿ç”¨ç›¸åŒçš„scale factor
- ä¿®æ”¹å¤„ç†å‚æ•°åéœ€è¦é‡æ–°ç”Ÿæˆæ•°æ®

### å†…å­˜ä¼˜åŒ–
- é¢„ç”Ÿæˆçš„PNGæ–‡ä»¶åŠ è½½æ›´å¿«
- å»ºè®®ä½¿ç”¨NUM_WORKERS=0é¿å…å¤šè¿›ç¨‹é—®é¢˜

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ‰¾ä¸åˆ°å›¾åƒå¯¹**
   ```bash
   # æ£€æŸ¥ç›®å½•ç»“æ„
   ls -la OST_LR/scale_4x/
   # ç¡®ä¿scale factoråŒ¹é…
   ```

2. **å†…å­˜ä¸è¶³**
   ```python
   # å‡å°batch sizeæˆ–å›¾åƒå°ºå¯¸
   BATCH_SIZE = 1
   TARGET_SIZE = 256
   ```

3. **å¤„ç†æ—¶é—´è¿‡é•¿**
   ```bash
   # ä½¿ç”¨æ›´å¿«çš„æ’å€¼æ–¹æ³•
   python generate_lr_images.py --method linear
   # æˆ–è€…å…ˆå¤„ç†å°æ ·æœ¬
   python generate_lr_images.py --sample 0.1
   ```

## ğŸ“ˆ ä¸‹ä¸€æ­¥ä¼˜åŒ–

1. **å¢åŠ æ•°æ®å¢å¼º**: åœ¨é¢„ç”Ÿæˆé˜¶æ®µæ·»åŠ æ›´å¤šé™è´¨æ–¹å¼
2. **å¹¶è¡Œå¤„ç†**: ä½¿ç”¨å¤šè¿›ç¨‹åŠ é€Ÿå›¾åƒå¤„ç†
3. **å‹ç¼©å­˜å‚¨**: ä½¿ç”¨æ›´é«˜æ•ˆçš„å›¾åƒæ ¼å¼
4. **ç¼“å­˜æœºåˆ¶**: æ·»åŠ å¤„ç†ç»“æœç¼“å­˜é¿å…é‡å¤è®¡ç®—

---

**æ¨èä½¿ç”¨æµç¨‹**ï¼š
1. å…ˆç”¨ `--sample 0.01` å¿«é€Ÿæµ‹è¯•æ•´ä¸ªæµç¨‹
2. ç¡®è®¤æ— è¯¯åç”¨ `--sample 0.1` è¿›è¡Œè¾ƒå¤§è§„æ¨¡æµ‹è¯•
3. æœ€åä½¿ç”¨å®Œæ•´æ•°æ®é›†è¿›è¡Œæ­£å¼è®­ç»ƒ
